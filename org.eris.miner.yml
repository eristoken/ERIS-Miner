app-id: org.eris.miner
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: eris-miner
finish-args:
  - --share=ipc
  - --share=network
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=dri
  - --filesystem=home
  - --filesystem=host
modules:
  - name: eris-miner
    buildsystem: simple
    build-commands:
      - |
        # Install the executable
        if [ -f eris-miner ]; then
          install -Dm755 eris-miner $FLATPAK_DEST/bin/eris-miner
        elif [ -f ERIS-Miner ]; then
          install -Dm755 ERIS-Miner $FLATPAK_DEST/bin/eris-miner
        else
          echo "Error: Could not find executable"
          ls -la
          exit 1
        fi
        # Copy resources directory
        if [ -d resources ]; then
          cp -r resources $FLATPAK_DEST/
        fi
        # Copy locales if they exist
        if [ -d locales ]; then
          cp -r locales $FLATPAK_DEST/ || true
        fi
        # Copy other necessary files
        for file in *.pak *.bin *.dat; do
          if [ -f "$file" ]; then
            cp "$file" $FLATPAK_DEST/ || true
          fi
        done
        # Install icon
        if [ -f eris_token_app_icon.png ]; then
          install -Dm644 eris_token_app_icon.png $FLATPAK_DEST/share/icons/hicolor/512x512/apps/org.eris.miner.png
        fi
    sources:
      - type: archive
        path: eris-miner-linux.tar.gz
        dest: .
        strip-components: 1
    post-install:
      - |
        # Create desktop file
        mkdir -p $FLATPAK_DEST/share/applications
        cat > $FLATPAK_DEST/share/applications/org.eris.miner.desktop <<EOF
        [Desktop Entry]
        Type=Application
        Name=ERIS Miner
        Comment=ERC-918 Token Miner
        Exec=eris-miner
        Icon=org.eris.miner
        Categories=Network;Finance;
        EOF
        # Create appdata file
        mkdir -p $FLATPAK_DEST/share/metainfo
        cat > $FLATPAK_DEST/share/metainfo/org.eris.miner.appdata.xml <<EOF
        <?xml version="1.0" encoding="UTF-8"?>
        <component type="desktop-application">
          <id>org.eris.miner</id>
          <name>ERIS Miner</name>
          <summary>ERC-918 Token Miner</summary>
          <description>
            <p>An Electron-based application for mining ERC-918 tokens.</p>
          </description>
          <launchable type="desktop-id">org.eris.miner.desktop</launchable>
        </component>
        EOF

